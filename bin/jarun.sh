#!/usr/bin/env bash
# #######################################################################
# this script aims to run jar file which is built on spring boot 2.3.12+.
# it supports many modes. see config/services.ini for detail.
#
# author: Leo ning <windywany@gmail.com>
# date: 2022-08-06
# version: 1.0.0
#
### do not edit this file unless you known what you are doing.###########
#########################################################################
if [ -n "${XDEBUG}" ]; then
    export XDEBUG
fi

function change_to_workdir {
    SOURCE="$1"

    while [ -h "$SOURCE" ]; do
        DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
        SOURCE="$(readlink "$SOURCE")"
        [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
    done

    BASE_DIR="$(cd -P "$(dirname "$SOURCE")/../" && pwd)"
    cd ${BASE_DIR}
    export JARUN_BASE_DIR=$BASE_DIR

    . ~+/bin/lib/functions.sh

    print_brand '1.0.0'
}

change_to_workdir $0

if ! detect_java_installation; then
    exit 1
fi

if ! load_services_config "$JARUN_BASE_DIR/config/services.ini"; then
    exit 1
fi

if [ $# -le 1 ]; then
    service_lists=(${sections[@]})
else
    service_lists=($@)
fi

case $1 in
start)
    start_app "${service_lists[@]:1}"
    ;;
stop)
    stop_app "${service_lists[@]:1}"
    ;;
restart)
    restart_app "${service_lists[@]:1}"
    ;;
config)
    show_app_config "${service_lists[@]:1}"
    ;;
help)
    print_help
    ;;
*)
    echo -e "Unknown command:" $(clr_str red "$1")
    print_help
    ;;
esac
### do not edit above codes #############################################
#########################################################################
