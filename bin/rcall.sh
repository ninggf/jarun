#!/usr/bin/env bash
# #######################################################################
# this script aims to run jar file which is built on spring boot 2.3.12+.
# it supports many modes. see config/services.ini for detail.
#
# author: Leo ning <windywany@gmail.com>
# date: 2022-08-06
# version: 1.0.0
#
### do not edit this file unless you known what you are doing.###########
#########################################################################
if [ $# -lt 14 ]; then
    echo "invalid arguments!!!"
    exit 1
fi

if [ -n "${XDEBUG}" ]; then
    export XDEBUG=${XDEBUG}
fi

function change_to_workdir {
    local SOURCE="$1"

    while [ -h "$SOURCE" ]; do
        DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
        SOURCE="$(readlink "$SOURCE")"
        [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
    done

    local BASE_DIR="$(cd -P "$(dirname "$SOURCE")/../" && pwd)"
    cd ${BASE_DIR}
    export JARUN_BASE_DIR=$BASE_DIR
    . "$BASE_DIR/bin/lib/functions.sh"
}

change_to_workdir $0

if ! detect_java_installation; then
    exit 1
fi

export RUN_MODE="${12}"
export ENV="${13}"

case "${14}" in
start)
    bash "$JARUN_BASE_DIR/bin/lib/run_jar.sh" "$@"
    ;;
stop)
    bash "$JARUN_BASE_DIR/bin/lib/stop_jar.sh" "$@"
    ;;
*)
    exit 1
    ;;
esac
### do not edit above codes #############################################
#########################################################################
